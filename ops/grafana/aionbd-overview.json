{
  "annotations": {
    "list": []
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "type": "timeseries",
      "title": "Requests/s",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 0 },
      "targets": [
        {
          "expr": "rate(aionbd_http_requests_total[5m])",
          "legendFormat": "requests/s",
          "refId": "A"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "5xx ratio",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 0 },
      "targets": [
        {
          "expr": "rate(aionbd_http_requests_5xx_total[5m]) / clamp_min(rate(aionbd_http_requests_total[5m]), 1)",
          "legendFormat": "5xx ratio",
          "refId": "A"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Latency (us)",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 8 },
      "targets": [
        {
          "expr": "aionbd_http_request_duration_us_avg",
          "legendFormat": "avg",
          "refId": "A"
        },
        {
          "expr": "aionbd_http_request_duration_us_max",
          "legendFormat": "max_window",
          "refId": "B"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "In-flight requests",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 8 },
      "targets": [
        {
          "expr": "aionbd_http_requests_in_flight",
          "legendFormat": "in_flight",
          "refId": "A"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Readiness flags",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 16 },
      "targets": [
        { "expr": "aionbd_ready", "legendFormat": "ready", "refId": "A" },
        {
          "expr": "aionbd_engine_loaded",
          "legendFormat": "engine_loaded",
          "refId": "B"
        },
        {
          "expr": "aionbd_storage_available",
          "legendFormat": "storage_available",
          "refId": "C"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Persistence pressure",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 16 },
      "targets": [
        {
          "expr": "rate(aionbd_persistence_writes[5m])",
          "legendFormat": "writes/s",
          "refId": "A"
        },
        {
          "expr": "rate(aionbd_persistence_checkpoint_degraded_total[5m])",
          "legendFormat": "degraded_checkpoint/s",
          "refId": "B"
        },
        {
          "expr": "aionbd_persistence_wal_size_bytes",
          "legendFormat": "wal_bytes",
          "refId": "C"
        },
        {
          "expr": "aionbd_persistence_incremental_segments",
          "legendFormat": "incremental_segments",
          "refId": "D"
        },
        {
          "expr": "aionbd_persistence_incremental_size_bytes",
          "legendFormat": "incremental_bytes",
          "refId": "E"
        },
        {
          "expr": "rate(aionbd_persistence_checkpoint_success_total[5m])",
          "legendFormat": "checkpoint_success/s",
          "refId": "F"
        },
        {
          "expr": "rate(aionbd_persistence_checkpoint_error_total[5m])",
          "legendFormat": "checkpoint_error/s",
          "refId": "G"
        },
        {
          "expr": "aionbd_persistence_wal_tail_open",
          "legendFormat": "wal_tail_open",
          "refId": "H"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Index cache",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 24 },
      "targets": [
        {
          "expr": "aionbd_l2_index_cache_hit_ratio",
          "legendFormat": "hit_ratio",
          "refId": "A"
        },
        {
          "expr": "aionbd_l2_index_build_in_flight",
          "legendFormat": "build_in_flight",
          "refId": "B"
        },
        {
          "expr": "rate(aionbd_l2_index_build_failures[5m])",
          "legendFormat": "build_failures/s",
          "refId": "C"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Security counters",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 24 },
      "targets": [
        {
          "expr": "rate(aionbd_auth_failures_total[5m])",
          "legendFormat": "auth_failures/s",
          "refId": "A"
        },
        {
          "expr": "rate(aionbd_rate_limit_rejections_total[5m])",
          "legendFormat": "rate_limit_rejections/s",
          "refId": "B"
        },
        {
          "expr": "rate(aionbd_audit_events_total[5m])",
          "legendFormat": "audit_events/s",
          "refId": "C"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Tenant quota pressure",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 32 },
      "targets": [
        {
          "expr": "rate(aionbd_tenant_quota_collection_rejections_total[5m])",
          "legendFormat": "collection_rejections/s",
          "refId": "A"
        },
        {
          "expr": "rate(aionbd_tenant_quota_point_rejections_total[5m])",
          "legendFormat": "point_rejections/s",
          "refId": "B"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Data footprint indicators",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 32 },
      "targets": [
        {
          "expr": "aionbd_collections",
          "legendFormat": "collections",
          "refId": "A"
        },
        { "expr": "aionbd_points", "legendFormat": "points", "refId": "B" },
        {
          "expr": "aionbd_l2_indexes",
          "legendFormat": "l2_indexes",
          "refId": "C"
        },
        {
          "expr": "aionbd_collection_write_lock_entries",
          "legendFormat": "collection_write_lock_entries",
          "refId": "D"
        },
        {
          "expr": "aionbd_tenant_rate_window_entries",
          "legendFormat": "tenant_rate_window_entries",
          "refId": "E"
        },
        {
          "expr": "aionbd_tenant_quota_lock_entries",
          "legendFormat": "tenant_quota_lock_entries",
          "refId": "F"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Search traffic and IVF usage",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 40 },
      "targets": [
        {
          "expr": "rate(aionbd_search_queries_total[5m])",
          "legendFormat": "search_queries/s",
          "refId": "A"
        },
        {
          "expr": "rate(aionbd_search_ivf_queries_total[5m])",
          "legendFormat": "ivf_queries/s",
          "refId": "B"
        },
        {
          "expr": "rate(aionbd_search_ivf_fallback_exact_total[5m])",
          "legendFormat": "ivf_fallback_exact/s",
          "refId": "C"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "IVF fallback ratio",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 40 },
      "targets": [
        {
          "expr": "rate(aionbd_search_ivf_fallback_exact_total[5m]) / clamp_min(rate(aionbd_search_ivf_queries_total[5m]), 1)",
          "legendFormat": "fallback_ratio",
          "refId": "A"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Persistence scheduler and group commit pressure",
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 48 },
      "targets": [
        {
          "expr": "rate(aionbd_persistence_checkpoint_schedule_skips_total[5m])",
          "legendFormat": "schedule_skips/s",
          "refId": "A"
        },
        {
          "expr": "aionbd_persistence_checkpoint_in_flight",
          "legendFormat": "checkpoint_in_flight",
          "refId": "B"
        },
        {
          "expr": "aionbd_persistence_wal_group_queue_depth",
          "legendFormat": "queue_depth",
          "refId": "C"
        },
        {
          "expr": "rate(aionbd_persistence_wal_grouped_records_total[5m]) / clamp_min(rate(aionbd_persistence_wal_group_commits_total[5m]), 1)",
          "legendFormat": "avg_group_size",
          "refId": "D"
        }
      ]
    }
  ],
  "refresh": "30s",
  "schemaVersion": 39,
  "style": "dark",
  "tags": ["aionbd", "observability"],
  "templating": { "list": [] },
  "time": { "from": "now-6h", "to": "now" },
  "timepicker": {},
  "timezone": "browser",
  "title": "AIONBD Overview",
  "uid": "aionbd-overview",
  "version": 3,
  "weekStart": ""
}
